
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/example_within-subject-classification-riemannian.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_example_within-subject-classification-riemannian.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_example_within-subject-classification-riemannian.py:


Example: Within-subject classification with riemannian classifier
=================================================================

.. GENERATED FROM PYTHON SOURCE LINES 7-18

.. code-block:: Python

    import functools
    from pathlib import Path
    import mne
    import moabb.datasets
    import pyriemann

    import rosoku

    mne.set_log_level("CRITICAL")









.. GENERATED FROM PYTHON SOURCE LINES 19-72

.. code-block:: Python



    def func_load_epochs(keywords, mode, dataset, l_freq, h_freq, order_filter, tmin, tmax):
        subject = keywords[0]
        keywords = keywords[1:]

        sessions = dataset.get_data(subjects=[subject])
        raws = sessions[subject]["0"]

        epochs_list = []

        for (name_run, raw) in raws.items():
            if not True in [k in name_run for k in keywords]:
                continue

            raw.filter(
                l_freq=l_freq,
                h_freq=h_freq,
                method="iir",
                iir_params={"ftype": "butter", "order": order_filter, "btype": "bandpass"},
            )

            raw = raw.pick(picks="eeg")

            epochs = mne.Epochs(
                raw=raw,
                tmin=tmin,
                tmax=tmax,
                baseline=None,
            )

            epochs_list.append(epochs)

        return mne.concatenate_epochs(epochs_list)


    def func_proc_epochs(epochs, mode):
        # do nothing in this example
        return epochs


    def convert_epochs_to_ndarray(
            epochs,
            mode,
            label_keys,
    ):
        X = epochs.get_data()
        X = pyriemann.estimation.Covariances().transform(X)
        y = rosoku.utils.get_labels_from_epochs(epochs, label_keys)

        return X, y









.. GENERATED FROM PYTHON SOURCE LINES 73-97

.. code-block:: Python


    subject = 56

    dataset = moabb.datasets.Dreyer2023()
    label_keys = {"left_hand": 0, "right_hand": 1}

    save_base = Path("~").expanduser() / "rosoku-log"

    results = rosoku.conventional(
        keywords_train=[subject, "R1", "R2"],
        keywords_test=[[subject, "R3", "R4", "R5"]],
        func_load_epochs=functools.partial(func_load_epochs, dataset=dataset, l_freq=8.0, h_freq=30.0, order_filter=4,
                                           tmin=dataset.interval[0] + 0.5, tmax=dataset.interval[1]),
        func_proc_epochs=func_proc_epochs,
        func_convert_epochs_to_ndarray=functools.partial(
            convert_epochs_to_ndarray, label_keys=label_keys
        ),
        samples_fname=save_base / "samples.parquet"
    )

    for m in range(results.shape[0]):
        print(results.loc[m])

    results.to_parquet(save_base / "results.parquet")




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    0it [00:00, ?it/s]    9it [00:00, 25644.52it/s]
    0it [00:00, ?it/s]    9it [00:00, 24933.11it/s]
    keywords_train          [56, "R1", "R2"]
    keywords_test     [56, "R3", "R4", "R5"]
    classifier                          tslr
    accuracy                        0.991667
    Name: 0, dtype: object
    keywords_train          [56, "R1", "R2"]
    keywords_test     [56, "R3", "R4", "R5"]
    classifier                           mdm
    accuracy                        0.991667
    Name: 1, dtype: object





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.491 seconds)


.. _sphx_glr_download_auto_examples_example_within-subject-classification-riemannian.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: example_within-subject-classification-riemannian.ipynb <example_within-subject-classification-riemannian.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: example_within-subject-classification-riemannian.py <example_within-subject-classification-riemannian.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: example_within-subject-classification-riemannian.zip <example_within-subject-classification-riemannian.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
